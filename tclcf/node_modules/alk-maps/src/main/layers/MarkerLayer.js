var LayerApi = require('./LayerApi')

module.exports = function(ALKMaps, map, options) {

    var layer = new ALKMaps.Layer.Markers(options.layerName || 'Marker Layer')
    var icon = new ALKMaps.Icon(options.icon || ALKMaps.IMAGE.TRUCK_BLUE, new ALKMaps.Size(30, 30))
    map.addLayer(layer)

    //API related stuff
    var api = new LayerApi(ALKMaps, map, layer, null, options)

    api.addItem = function(item, addOptions) {
        var lonLat = api.createLonLat(item.location.lon, item.location.lat)
        var itemIcon = addOptions.icon ? new ALKMaps.Icon(addOptions.icon, new ALKMaps.Size(30, 30)) : icon
        var hoverText = item[addOptions.hoverField || 'hover']
        var marker = new ALKMaps.Marker(
            lonLat,
            itemIcon.clone(),
            hoverText || null,
            {
                map: map,
                mouseOver: !!hoverText
            }
        )
        marker.attributes = item
        layer.addMarker(marker)
    }

    api.clearItems = function() {
        layer.clearMarkers()
    }

    return api
}
