var VectorLayer = require('./VectorLayer')

module.exports = function(ALKMaps, map, options) {
    options.layerName = options.layerName || 'Polygon Layer'

    var api = new VectorLayer(ALKMaps, map, options)
    api.eventsEnabled = false

    var points = []
    var features = []
    api.addItem = function(item) {
        points.push(new ALKMaps.Geometry.Point(item.location.lon, item.location.lat))
    }

    api.doneAddingItems = function() {
        var projectedPoints = ALKMaps.Geometry.Point.transformArray(
            points,
            new ALKMaps.Projection('EPSG:4326'),
            map.getProjectionObject()
        )

        var ringFeature = new ALKMaps.Feature.Vector(
            new ALKMaps.Geometry.LinearRing(projectedPoints),
            null,
            {
                fillColor: options.fillColor || '#AA0000',
                fillOpacity: options.fillOpacity || 0.5,
                strokeColor: options.strokeColor || '#AA0000',
                strokeWidth: options.strokeWidth || 3
            }
        )

        features.push(ringFeature)
        api.layer.removeAllFeatures()
        api.layer.addFeatures(features)
        points = []
    }

    api.clearItems = function() {
        api.layer.removeAllFeatures()
        features = []
        points = []
    }

    return api
}
