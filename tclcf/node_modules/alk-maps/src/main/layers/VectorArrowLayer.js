var VectorLayer = require('./VectorLayer')

module.exports = function(ALKMaps, map, options) {
    options.layerName = options.layerName || 'Vector Arrow Layer'
    options.disableClustering = true

    var api = VectorLayer(ALKMaps, map, options)
    api.eventsEnabled = false

    //These are set to null because line arrow line styling must be done on creation
    options.defaultStyle = null
    options.selectedStyle = null
    api.styleMap = null

    api.addItem = function(item) {
        api.vectors.push(item)
    }

    api.doneAddingItems = function() {
        var lines = []
        api.vectors.forEach(function(element, index, array) {
            if (index < array.length-1) {
                var lonLat1 = api.createLonLat(element.location.lon, element.location.lat)
                var lonLat2 = api.createLonLat(array[index+1].location.lon, array[index+1].location.lat)

                var vector = new ALKMaps.Feature.Vector(
                    new ALKMaps.Geometry.LineString([new ALKMaps.Geometry.Point(lonLat1.lon, lonLat1.lat),
                        new ALKMaps.Geometry.Point(lonLat2.lon, lonLat2.lat)]), null, {
                        strokeColor: options.strokeColor || '#666666',
                        strokeWidth: options.strokeWidth || 4,
                        arrows: 'line',
                        arrowSpacing: options.arrowSpacing || 20
                    }

                )

                lines.push(vector)
            }
        })

        api.layer.addFeatures(lines)
        api.vectors = []
    }


    return api
}
