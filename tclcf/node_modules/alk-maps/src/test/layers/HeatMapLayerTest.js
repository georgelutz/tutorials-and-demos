describe('HeatMapLayer', function() {
    var ALKMaps
    var map
    var LayerApi
    var HeatMapLayer
    var layer

    beforeEach(function() {
        layer = {}
        layer.updateOptions = sinon.stub()

        ALKMaps = new MockALKMaps()
        ALKMaps.Layer.HeatMap.returns(layer)

        map = new MockMap()
        LayerApi = new MockLayerApi()

        HeatMapLayer = proxyquire('../main/layers/HeatMapLayer', {
            './LayerApi': LayerApi.constructor
        })
    })

    it('should create a layer', function() {
        var heatMapLayerApi = new HeatMapLayer(ALKMaps, map, {})

        ALKMaps.Layer.HeatMap.should.have.been.calledWith('HeatMap Layer')
        layer.updateOptions.should.have.been.called
        map.addLayer.should.have.been.calledWith(layer)
        heatMapLayerApi.should.equal(LayerApi.api)
    })

    it('should support options', function() {
        var options = { layerName: 'abc', heatMapStyle: { abc: '123'}}
        var heatMapLayerApi = new HeatMapLayer(ALKMaps, map, options)

        ALKMaps.Layer.HeatMap.should.have.been.calledWith('abc')
        layer.updateOptions.should.have.been.calledWith(options.heatMapStyle)
        map.addLayer.should.have.been.calledWith(layer)
        heatMapLayerApi.should.equal(LayerApi.api)
    })

    describe('once created', function() {
        var heatMapLayerApi

        beforeEach(function() {
            heatMapLayerApi = new HeatMapLayer(ALKMaps, map, {})
        })

        it('should support adding items', function() {
            layer.setPoints = sinon.stub()
            var item1 = {
                location: {
                    lon: 123,
                    lat: 321
                }
            }
            var item2 = {
                location: {
                    lon: 456,
                    lat: 654
                }
            }

            heatMapLayerApi.addItem(item1)
            heatMapLayerApi.addItem(item2)
            heatMapLayerApi.doneAddingItems()

            layer.setPoints.should.have.been.calledWith([{ lon: 123, lat: 321 }, { lon: 456, lat: 654 }])
        })

        it('should support clearing items', function() {
            layer.clearPoints = sinon.stub()

            heatMapLayerApi.clearItems()

            layer.clearPoints.should.have.been.calledWith()
        })
    })
})
