module.exports = {
    dependencies: [
        'build-locale-files',
        'build-static'
    ],
    task: (gulp, config, done) => {
        var _ = require('lodash')
        var gutil = require('gulp-util')
        
        setTimeout(() => {
            function debounceTask(task) {
                return _.debounce(file => {
                    gutil.log(gutil.colors.yellow('File changed:'), file.path)
                    gulp.start(task)
                }, 250)
            }

            // locales
            let localeFiles = _.flattenDeep(_.map(config.localeBundles, 'files'))
            gulp.watch(localeFiles, debounceTask('build-locale-files'))

            //static
            let staticFiles = _.flattenDeep(_.map(config.staticFiles, 'files'))
            gulp.watch(staticFiles, debounceTask('build-static'))

            done()
        })
    }
}
