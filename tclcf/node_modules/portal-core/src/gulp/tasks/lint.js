module.exports = function(gulp, config) {
    var _ = require('lodash')
    var eslint = require('gulp-eslint')
    var gulpIf = require('gulp-if')
    
    var hasFixFlag = (process.argv.slice(2).indexOf('--fix') >= 0)

    var stream = gulp.src(config.jsLint)
        .pipe(eslint({
            fix: hasFixFlag
        }))
        .pipe(eslint.format())
        .pipe(eslint.failAfterError())

    if (hasFixFlag) {
        // if eslint fixed the file, write the file to dest
        return stream
            .pipe(gulpIf(file => !!_.get(file, 'eslint.fixed'), gulp.dest(config.lintOutput)))
    }
    
    return stream
}
