module.exports = /* @ngInject */
    function($log, $translate, Restangular, dialogService, toastService) {
        let translations = {}
        $translate([
            'application.applicationEdit.err_deleting'
        ]).then(translated => translations = translated)

        Restangular.addElementTransformer('applications', false, application => {
            if (application.id) {
                application.key = application.id
            }

            application.confirmDelete = function(event) {
                var confirmOptions = {
                    entityName: application.name,
                    targetEvent: event
                }

                return dialogService.showConfirmDelete(confirmOptions)
                    .then(() => application.remove())
                    .then(() => application.deleted = true)
                    .catch(err => {
                        if (err) {
                            $log.error('Error deleting application.', err)
                            toastService.show(translations['application.applicationEdit.err_deleting'], {theme: 'warn'})
                        }
                    })
            }

            return application
        })
    }
