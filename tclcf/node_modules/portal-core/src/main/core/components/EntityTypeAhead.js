var _ = require('lodash')

module.exports = {
    template: require('../views/entityTypeAhead.html'),
    bindings: {
        entity: '@',
        $ctrl: '<',
        field: '@',
        placeholder: '@',
        label: '@'
    },
    controller: class EntityTypeAhead {
        /* @ngInject */
        constructor(Restangular) {
            this.Restangular = Restangular
        }

        $onInit() {
            this.selectedItem = _.get(this.$ctrl, this.field)
        }

        selectedItemChange(item) {
            item = item || {}
            item.$dirty = true
            this.$ctrl[this.field] = item
        }

        performQuery(q) {
            return this.Restangular.all(this.entity).getList({q: q, globalsearch: true})
        }
    }
}
