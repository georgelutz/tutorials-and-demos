var _ = require('lodash')

module.exports = /* @ngInject */
    function($translateProvider, tmhDynamicLocaleProvider, localeHelper) {

        // Setup angular-translate
        $translateProvider
            .useMissingTranslationHandler('i18nTranslationHandler')
            .useSanitizeValueStrategy(null) // TODO: find workaround for angular-translate 3
            .useStaticFilesLoader({
                prefix: '/',
                suffix: 'en-US.json'.replace('en-US', '') // hack for versioning
            })
            .registerAvailableLanguageKeys(localeHelper.locales, localeHelper.languageKeys)
            .fallbackLanguage('en-US')
            .determinePreferredLanguage()

        // When the locale isn't registered above, we need to explicitly set 'en-US' as the locale
        var locale = $translateProvider.preferredLanguage()
        if (!_.includes(localeHelper.locales, locale)) {
            $translateProvider.preferredLanguage(localeHelper.defaultLocale)
        }

        // Setup dynamically changing angular-i18n script tag
        tmhDynamicLocaleProvider.localeLocationPattern(// hack for versioning
            'angular-i18n/angular-locale_en-us.js'.replace('en-us', '{{locale}}')
        )
        // TODO: minify these scripts
    }

