var _ = require('lodash')

module.exports = /* @ngInject */
    function($log, Restangular, urlConfig) {

        //url management
        var baseUrl = urlConfig.getUrl()
        if (baseUrl) {
            Restangular.setBaseUrl(baseUrl)
        } else {
            $log.error('Invalid url/environment detected.')
        }

        //Restangular key field
        Restangular.setRestangularFields({
            id: 'key'
        })

        //handle special response types
        Restangular.addResponseInterceptor(function(data, operation) {
            var extractedData

            //clean up list calls
            if (operation === 'getList' && _.isArray(data.data)) {
                extractedData = data.data
                extractedData.responseDescription = data.responseDescription
                extractedData.metaData = data.metaData
                return extractedData
            } else {
                return data
            }
        })
    }
