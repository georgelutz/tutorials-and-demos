<div flex layout="column" id="navigation-container" class="full-view-container" md-theme="{{$ctrl.getTheme()}}" md-theme-watch>
    
    <!-- theme link color -->
    <style ng-bind="::$ctrl.getLinkStyle()"></style>

    <!-- loadingService loading indicator -->
    <div id="loading-container" ng-if="$ctrl.pageLoading()">
        <md-progress-circular md-diameter="48"></md-progress-circular>
    </div>

    <!-- resolve/page loading indicator -->
    <md-progress-linear ng-show="$ctrl.loading || $ctrl.pageAsyncLoading()"
                        class="md-accent"
                        md-mode="indeterminate">
    </md-progress-linear>

    <div layout="row" id="page-container" class="full-view-container">

        <!-- sidenav -->
        <md-sidenav id="sidenav-container" class="site-sidenav md-sidenav-left md-whiteframe-z1"
                    md-component-id="left" md-is-locked-open="$ctrl.lockSidenav()">

            <!-- nav logo -->
            <a ng-href="#/" class="nav-logo-container">
                <img class="nav-logo" ng-src="{{$ctrl.navImageUrl}}">
            </a>

            <!-- nav menu -->
            <menu-container></menu-container>
        </md-sidenav>

        <div flex layout="column" class="full-view-container">

            <!-- top bar -->
            <md-toolbar class="site-content-toolbar">

                <div layout="row" layout-align="start center">

                    <!-- hamburger menu button -->
                    <md-button id="nav-hamburger" class="md-icon-button"
                               ng-show="!$ctrl.lockSidenav()" ng-click="$ctrl.openSidenav()">
                        <md-icon>menu</md-icon>
                    </md-button>

                    <!-- global search bar -->
                    <div flex ng-class="{'global-search-spacer-left': $ctrl.lockSidenav()}">
                        <global-search flex></global-search>
                    </div>

                    <!-- app menu -->
                    <candy-bar></candy-bar>

                    <!-- user menu -->
                    <md-menu id="user-profile-menu" md-position-mode="target-right target">
                        <md-button md-menu-origin ng-click="$mdOpenMenu()">
                            <span id="user-profile-menu-spacer" ng-show="$ctrl.$mdMedia('gt-sm')"></span>

                            <div id="user-profile-menu-person-icon">
                                <md-icon>person</md-icon>
                            </div>
                            <span id="user-profile-menu-name" hide-sm hide-xs>
                                {{$ctrl.authService.currentUser.firstName + ' ' + $ctrl.authService.currentUser.lastName}}
                            </span>
                            <md-icon hide-sm hide-xs id="user-profile-menu-arrow-icon">arrow_drop_down</md-icon>
                        </md-button>

                        <!-- user menu content -->
                        <md-menu-content width="4">

                            <!-- User Profile -->
                            <md-menu-item ng-if="!$ctrl.authService.currentUser.anonymous">
                                <md-button ui-sref="nav.user.edit({id: $ctrl.authService.currentUser.uid})" ng-click="$mdCloseMenu()">
                                    <md-icon>person</md-icon>
                                    <span ng-bind="'user.userEditProfile.user_profile' | translate"></span>
                                </md-button>
                            </md-menu-item>

                            <!-- Change Logs -->
                            <md-menu-item ng-if="$ctrl.authService.currentUser.hasPermission('ROLE_CHANGELOG_READ')">
                                <md-button ui-sref="nav.changelogs" ng-click="$mdCloseMenu()">
                                    <md-icon>new_releases</md-icon>
                                    <span ng-bind="'core.changelogs.change_logs' | translate"></span>
                                </md-button>
                            </md-menu-item>

                            <!-- Release Notes -->
                            <md-menu-item>
                                <md-button ui-sref="nav.releasenotes" ng-click="$mdCloseMenu()">
                                    <md-icon>fiber_new</md-icon>
                                    <span ng-bind="'core.changelogs.release_notes' | translate"></span>
                                </md-button>
                            </md-menu-item>

                            <!-- Configurable items -->
                            <div ng-repeat="item in $ctrl.userMenu">
                                <md-menu-item>
                                    <md-button ui-sref="{{item.href}}" ng-click="$mdCloseMenu()">
                                        <md-icon>{{item.icon}}</md-icon>
                                        <span ng-bind="item.title | translate"></span>
                                    </md-button>
                                </md-menu-item>
                            </div>
                            <md-divider></md-divider>

                            <!-- Login -->
                            <md-menu-item ng-if="$ctrl.authService.currentUser.anonymous && !$ctrl.authConfig.hideLogin">
                                <md-button ng-click="$ctrl.login()">
                                    <md-icon>lock_open</md-icon>
                                    <span ng-bind="'login.login.login' | translate"></span>
                                </md-button>
                            </md-menu-item>

                            <!-- Logout -->
                            <md-menu-item ng-if="!$ctrl.authService.currentUser.anonymous">
                                <md-button ui-sref="logout" ng-click="$mdCloseMenu()">
                                    <md-icon>lock</md-icon>
                                    <span ng-bind="'login.login.logout' | translate"></span>
                                </md-button>
                            </md-menu-item>
                        </md-menu-content>
                    </md-menu>
                </div>

            </md-toolbar>

            <!-- container for the toasts -->
            <div id="toast-container" ng-class="{ navLocked: $ctrl.$mdMedia('gt-md')}"></div>

            <!-- content section -->
            <ui-view id="main-content"></ui-view>
        </div>

    </div>

</div>
