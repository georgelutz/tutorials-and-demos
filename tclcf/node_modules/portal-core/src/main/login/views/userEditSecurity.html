<div class="user-edit-container" ng-if="$ctrl.editingSelf">

    <form name="$ctrl.emailForm"
          ng-submit="$ctrl.user.confirmSaveEmail($event)">
        <md-subheader class="md-no-sticky user-subheader">
            {{'user.userEditSecurity.email_change' | translate}}
        </md-subheader>

        <div layout="row">
            <md-input-container flex>
                <label translate="user.common.email"></label>
                <input type="email"
                       ng-model="$ctrl.user.userEmails[0]['emailAddress']"
                       name="email"
                       required/>
                <ng-messages for="$ctrl.emailForm.email.$error" md-auto-hide="false" ng-if="$ctrl.emailForm.email.$touched">
                    <ng-message when="required">{{'user.common.email_required' | translate}}</ng-message>
                    <ng-message when="email">{{'user.common.email_invalid' | translate}}</ng-message>
                    <ng-message when="changed">{{'user.userEditSecurity.email_not_edited' | translate}}</ng-message>
                    <field-error field="email"></field-error>
                    <field-error field="username"></field-error>
                </ng-messages>

            </md-input-container>
        </div>

        <div layout="row" layout-align="end center">
            <md-button md-primary type="submit">{{'user.userEditSecurity.email_change' | translate}}</md-button>
        </div>
    </form>

    <form name="$ctrl.passwordForm"
          ng-submit="$ctrl.passwordForm.$valid && $ctrl.user.submitPassword($ctrl.currentPassword, $ctrl.newPassword) 
          && $ctrl.clearPasswordFields()">
        <div layout="column">
            <md-subheader class="md-no-sticky">
                {{'user.userEditSecurity.password_change' | translate}}
            </md-subheader>
            <md-input-container ng-if="!$ctrl.user.adding">
                <label translate="user.userEditSecurity.curr_password"></label>
                <input type="password"
                       name="currentPassword"
                       ng-model="$ctrl.currentPassword"
                       required/>
                <ng-messages for="$ctrl.passwordForm.currentPassword.$error" 
                             md-auto-hide="false" 
                             ng-if="$ctrl.passwordForm.currentPassword.$touched">
                    <ng-message when="required">{{'user.userEditSecurity.curr_password_req' | translate}}</ng-message>
                    <field-error field="currentPassword"></field-error>
                </ng-messages>
            </md-input-container>
            <md-input-container>
                <label translate="user.userEditProfile.new_password"></label>
                <input type="password"
                       name="newPassword"
                       ng-model="$ctrl.newPassword"
                       ng-change="$ctrl.comparePasswordFields()"
                       required/>
                <ng-messages for="$ctrl.passwordForm.newPassword.$error" 
                             md-auto-hide="false" 
                             ng-if="$ctrl.passwordForm.newPassword.$touched">
                    <ng-message when="different">{{'user.common.password_differ' | translate}}</ng-message>
                    <ng-message when="required">{{'user.common.new_password_required' | translate}}</ng-message>
                    <field-error field="newPassword"></field-error>
                </ng-messages>

            </md-input-container>

            <md-input-container>
                <label translate="user.common.conf_password"></label>
                <input type="password"
                       name="confirmPassword"
                       ng-model="$ctrl.confirmPassword"
                       ng-change="$ctrl.comparePasswordFields()"/>

                <ng-messages for="$ctrl.passwordForm.confirmPassword.$error" 
                             md-auto-hide="false" 
                             ng-if="$ctrl.passwordForm.confirmPassword.$touched">
                    <ng-message when="fieldEquality">{{'user.common.password_not_eq' | translate}}
                    </ng-message>
                    <field-error field="password"></field-error>
                </ng-messages>
            </md-input-container>
        </div>

        <br/>

        <div layout="row" layout-align="end center">
            <md-button md-primary type="submit">{{'user.userEditSecurity.change_password' | translate}}</md-button>
        </div>
    </form>
</div>
<md-subheader class="md-primary md-no-sticky user-subheader" 
              layout layout-align="start start" 
              ng-if="!$ctrl.editingSelf">{{'user.userEditSecurity.change_password_msg' | translate}}
</md-subheader>
