const _ = require('lodash')

require('../styles/login.scss')

require('../images/login_bg.jpg')
require('../images/login_logo.png')

module.exports = {
    template: require('../views/login.html'),
    controller: class Login {
        /* @ngInject */
        constructor(authService, themeService) {
            this.authService = authService
            this.themeService = themeService
        }

        $onInit() {
            this.loginImageUrl = this.themeService.getLogin()

            if (!this.authService.isLoggedIn()) {
                this.login()
            }
        }
        
        login() {
            _.defer(() => this.loading = true)
            return this.authService.login()
                .then(() => this.loading = false)
                .catch(() => {
                    //show the login form again if we error
                    return this.login()
                })
        }
    }
}
