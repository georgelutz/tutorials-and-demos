module.exports = /* @ngInject */
    function($log, $translate, dialogService, Restangular, toastService) {
        let translations = {}
        $translate([
            'permissionNew.permissionEdit.error.on_delete'
        ])
            .then(translated => translations = translated)

        Restangular.addElementTransformer('permissions', false, permission => {
            if (permission.id) {
                permission.key = permission.id
            }

            permission.confirmDelete = event => {
                let confirmDeleteOptions = {
                    entityName: permission.name,
                    targetEvent: event
                }

                return dialogService.showConfirmDelete(confirmDeleteOptions)
                    .then(() => permission.remove())
                    .then(() => {
                        permission.deleted = true
                        return permission
                    })
                    .catch(err => {
                        if (err) {
                            $log.error('Error deleting permission', err)
                            toastService.show(translations['permissionNew.permissionEdit.error.on_delete'], {theme: 'warn'})
                        }
                    })
            }

            return permission
        })
    }
