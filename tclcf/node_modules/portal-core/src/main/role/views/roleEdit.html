<page-header
        title="{{'role.roleEdit.' + ($ctrl.role.adding ? 'add' : 'edit') | translate}}"
        back-button-handler="'nav.role.list'"
></page-header>

<standard-card>
    <form name="$ctrl.form" layout="column" ng-submit="$ctrl.form.$valid && $ctrl.save()">

        <md-subheader class="md-no-sticky">
            {{'role.roleEdit.information' | translate}}
        </md-subheader>

        <!-- name -->
        <md-input-container>
            <label translate="role.roleEdit.name"></label>
            <input type="text"
                   ng-model="$ctrl.role.name"
                   ng-minlength=3
                   ng-maxlength=50
                   name="name"
                   required
                   auto-focus/>
            <ng-messages for="$ctrl.form.name.$error" md-auto-hide="false" ng-if="$ctrl.form.name.$touched">
                <ng-message when="required">{{'role.roleEdit.name_required' | translate}}</ng-message>
                <ng-message when="minlength">{{'role.roleEdit.name_min' | translate}}</ng-message>
                <ng-message when="maxlength">{{'role.roleEdit.name_max' | translate}}</ng-message>
            </ng-messages>
        </md-input-container>

        <!-- description -->
        <md-input-container>
            <label translate="role.roleEdit.description"></label>
            <input type="text"
                   ng-model="$ctrl.role.description"
                   ng-minlength=3
                   ng-maxlength=100
                   name="description" required/>
            <ng-messages for="$ctrl.form.description.$error" md-auto-hide="false" ng-if="$ctrl.form.description.$touched">
                <ng-message when="required">{{'role.roleEdit.description_required' | translate}}</ng-message>
                <ng-message when="minlength">{{'role.roleEdit.description_min' | translate}}</ng-message>
                <ng-message when="maxlength">{{'role.roleEdit.description_max' | translate}}</ng-message>
            </ng-messages>
        </md-input-container>

        <!-- org types -->
        <md-subheader class="md-no-sticky">
            {{'role.common.organization_types' | translate}}
        </md-subheader>
        <md-checkbox
                ng-model="organizationType.selected"
                ng-repeat="organizationType in $ctrl.organizationTypes"
                class="md-primary role-edit-checkbox">
            {{organizationType.displayName}}
        </md-checkbox>

        <br>
        <md-divider></md-divider>
        <br>

        <!-- applications -->
        <md-subheader class="md-no-sticky">
            {{'role.common.applications' | translate}}
        </md-subheader>
        <md-checkbox
                ng-model="application.selected"
                ng-repeat="application in $ctrl.applications"
                class="md-primary role-edit-checkbox">
            {{application.name}}
        </md-checkbox>

        <br>
        <md-divider></md-divider>
        <br>

        <!-- permissions -->
        <div layout="row" layout-wrap layout-align="start center">
            <md-subheader class="md-no-sticky role-edit-permission-header">
                {{'role.common.permissions' | translate}}
            </md-subheader>

            <span flex></span>

            <!-- permission filter -->
            <md-input-container flex md-no-float class="role-edit-permission-search">
                <md-icon>search</md-icon>
                <input type="text" placeholder="{{'core.common.form.search' | translate}}" ng-model="filter"/>
            </md-input-container>
        </div>
        <md-checkbox
                class="md-primary role-edit-permission role-edit-checkbox"
                ng-model="permission.selected"
                title="{{permission.name}}"
                ng-repeat="permission in $ctrl.permissions | filter: filter">
            <div class="role-edit-permission-name">{{permission.name.substr(5) | startCase}}</div>
            <div class="role-edit-permission-desc">{{permission.description}}</div>
        </md-checkbox>

        <div layout-align="end center" layout="row">
            <md-button
                    type="button"
                    class="md-raised md-warn"
                    ng-hide="$ctrl.role.adding"
                    ng-click="$ctrl.confirmDelete($event)">
                {{'core.common.form.delete' | translate}}
            </md-button>

            <span flex></span>

            <md-button
                    class="md-cancel"
                    type="button"
                    ng-href="#/nav/role/list/">{{'core.common.form.cancel' | translate}}
            </md-button>
            <md-button
                    md-primary
                    type="submit">{{'core.common.form.save' | translate}}
            </md-button>
        </div>
    </form>
</standard-card>
