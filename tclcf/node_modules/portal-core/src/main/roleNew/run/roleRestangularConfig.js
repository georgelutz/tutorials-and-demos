module.exports = /* @ngInject */
    function($log, $translate, dialogService, Restangular, toastService) {
        let res = {}
        $translate([
            'roleNew.roleEdit.error.on_delete'
        ])
            .then(translated => res = translated)

        Restangular.addElementTransformer('roles', false, role => {
            if (role.id) {
                role.key = role.id
            }

            role.confirmDelete = event => {
                let confirmDeleteOptions = {
                    entityName: role.name,
                    targetEvent: event
                }

                return dialogService.showConfirmDelete(confirmDeleteOptions)
                    .then(() => role.remove())
                    .then(() => {
                        role.deleted = true
                        return role
                    })
                    .catch(err => {
                        if (err) {
                            $log.error('Error deleting role', err)
                            toastService.show(res['roleNew.roleEdit.error.on_delete'], {theme: 'warn'})
                        }
                    })
            }

            return role
        })
    }
