<page-header ng-if="$ctrl.user.adding" title="{{'userNew.common.add_user' | translate}}"></page-header>

<div class="standard-padding">
    <md-card class="user-profile-container">
        <md-card-content>
            <div class="md-card-content">
                <div layout="row">
                    <md-subheader class="md-no-sticky profile-headers">
                        {{'userNew.userProfile.account' | translate}}
                    </md-subheader>
                    <span flex></span>
                    <md-switch class="md-primary"
                               ng-model="$ctrl.user.status"
                               ng-true-value="1"
                               ng-false-value="0">
                        {{($ctrl.user.status ? 'userNew.common.active' :
                        'userNew.common.inactive') | translate}}
                    </md-switch>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.common.email"></label>
                            <input type="email"
                                   name="email"
                                   ng-model="$ctrl.user.userEmails[0].emailAddress"
                                   required/>
                        </md-input-container>
                    </div>
                    <span flex="5"></span>
                    <div layout="column" flex>
                        <md-switch class="md-primary"
                                   ng-model="$ctrl.user.userEmails[0]['verified']">
                            {{($ctrl.user.userEmails[0]['verified'] ? 'userNew.common.email_verified' :
                            'userNew.common.email_not_verified') | translate}}
                        </md-switch>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.common.first_name"></label>
                            <input type="text"
                                   name="firstName"
                                   md-minlength="2"
                                   md-maxlength="15"
                                   ng-model="$ctrl.user.firstName"
                                   required/>
                        </md-input-container>
                    </div>
                    <span flex="5"></span>
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.middle_initial"></label>
                            <input type="text"
                                   name="middleInitial"
                                   ng-model="$ctrl.user.middleInitial"
                                   required/>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.common.last_name"></label>
                            <input type="text"
                                   name="lastName"
                                   md-minlength="2"
                                   md-maxlength="15"
                                   ng-model="$ctrl.user.lastName"
                                   required/>
                        </md-input-container>
                    </div>
                    <span flex="5"></span>
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.suffix"></label>
                            <md-select ng-model="$ctrl.user.suffix"></md-select>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.common.phone"></label>
                            <input type="text"
                                   name="phone"
                                   ng-model="$ctrl.user.userPhones[0].phone"
                                   ng-pattern="/^\(?\d{3}\)?\s?\d{3}-?\d{4}$/"
                                   required/>
                        </md-input-container>
                    </div>
                    <span flex="5"></span>
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.common.extension"></label>
                            <input type="text"
                                   name="extension"
                                   ng-model="$ctrl.user.userPhones[0].extension"
                                   required/>
                        </md-input-container>
                    </div>
                </div>
                <md-divider class="extend-margins"></md-divider>
                <div layout="row">
                    <md-subheader translate="userNew.userProfile.preferences" class="bottom-padding"></md-subheader>
                </div>

                <div layout="row">
                    <md-switch ng-model="$ctrl.sidenavCollapse"
                               class="md-primary"
                               aria-label="{{'userNew.userProfile.side_nav_pref' | translate }}">
                        {{'userNew.userProfile.side_nav_pref' | translate}}
                    </md-switch>
                </div>

                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.locale_label"></label>
                            <md-select ng-model="$ctrl.locale">
                                <md-option ng-value="loc" ng-repeat="loc in $ctrl.locales">{{loc.name}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.units_of_volume_label"></label>
                            <md-select ng-model="$ctrl.volumeUnit">
                                <md-option ng-value="unitOfVolume" ng-repeat="unitOfVolume in $ctrl.unitsOfVolume">{{unitOfVolume.name | translate}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.units_of_temperature_label"></label>
                            <md-select ng-model="$ctrl.temperatureUnit">
                                <md-option ng-value="unitOfTemperature" ng-repeat="unitOfTemperature in $ctrl.unitsOfTemperature">{{unitOfTemperature.name | translate}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.units_of_pressure_label"></label>
                            <md-select ng-model="$ctrl.pressureUnit">
                                <md-option ng-value="unitOfPressure" ng-repeat="unitOfPressure in $ctrl.unitsOfPressure">{{unitOfPressure.name | translate}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.units_of_mass_label"></label>
                            <md-select ng-model="$ctrl.massUnit">
                                <md-option ng-value="unitOfMass" ng-repeat="unitOfMass in $ctrl.unitsOfMass">{{unitOfMass.name | translate}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <div layout="row" class="bottom-padding">
                    <div layout="column" flex>
                        <md-input-container>
                            <label translate="userNew.userProfile.units_of_distance_label"></label>
                            <md-select ng-model="$ctrl.distanceUnit">
                                <md-option ng-value="unitOfDistance" ng-repeat="unitOfDistance in $ctrl.unitsOfDistance">{{unitOfDistance.name | translate}}</md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
                <md-divider class="extend-margins"></md-divider>
                <div layout="row">
                    <md-subheader translate="userNew.common.organizations"></md-subheader>
                    <span flex></span>
                    <md-button class="md-icon-button"
                               aria-label="{{'userNew.userProfile.manage_orgs' | translate}}"
                               ng-click="$ctrl.showOrganizationListDialog()">
                        <md-icon ng-if="!$ctrl.user.userOrganizations[0]">add</md-icon>
                        <md-icon ng-if="$ctrl.user.userOrganizations[0]">edit</md-icon>
                    </md-button>
                </div>
                <md-divider ng-if="!$ctrl.user.userOrganizations[0]" class="extend-margins"></md-divider>
                <md-tabs ng-if="$ctrl.user.userOrganizations[0]" md-dynamic-height md-border-bottom tab-ink-bar class="extend-margins">
                    <md-tab ng-repeat="organization in $ctrl.user.userOrganizations">
                        <md-tab-label>
                            {{organization.id}}
                        </md-tab-label>
                        <md-tab-body>
                            <div class="org-tab-container">
                                <div layout="row">
                                    <md-subheader translate="userNew.common.roles"></md-subheader>
                                    <span flex></span>
                                    <md-button class="md-icon-button"
                                               aria-label="{{'userNew.userProfile.manage_roles' | translate}}"
                                               ng-click="$ctrl.showRoleListDialog(organization)">
                                        <md-icon ng-if="!organization.roles[0]">add</md-icon>
                                        <md-icon ng-if="organization.roles[0]">edit</md-icon>
                                    </md-button>
                                </div>
                                <md-divider ng-if="organization.roles[0]" class="dashed extend-margins"></md-divider>
                                <div ng-repeat="role in organization.roles">
                                    <div layout="row">
                                        <md-subheader class="profile-headers child-item">
                                            {{role.name}}
                                        </md-subheader>
                                        <span flex></span>
                                        <md-button class="md-icon-button" ng-click="$ctrl.removeRole(organization, role)">
                                            <md-icon>delete</md-icon>
                                        </md-button>
                                    </div>
                                    <md-divider class="dashed extend-margins"></md-divider>
                                </div>
                                <div ng-if="organization.roles[0]" class="top-padding"></div>
                                <md-divider class="extend-margins"></md-divider>
                                <div layout="row">
                                    <md-subheader translate="userNew.common.permissions">
                                    </md-subheader>
                                    <span flex></span>
                                    <md-button class="md-icon-button"
                                               aria-label="{{'userNew.userProfile.manage_permissions' | translate}}"
                                               ng-click="$ctrl.showPermissionListDialog(organization)">
                                        <md-icon ng-if="!organization.permissions[0]">add</md-icon>
                                        <md-icon ng-if="organization.permissions[0]">edit</md-icon>
                                    </md-button>
                                </div>
                                <md-divider ng-if="organization.permissions[0]" class="dashed extend-margins"></md-divider>
                                <div ng-repeat="permission in organization.permissions">
                                    <div layout="row">
                                        <md-subheader class="profile-headers child-item">
                                            {{permission.name}}
                                        </md-subheader>
                                        <span flex></span>
                                        <md-button class="md-icon-button" ng-click="$ctrl.removePermission(organization, permission)">
                                            <md-icon>delete</md-icon>
                                        </md-button>
                                    </div>
                                    <md-divider class="dashed extend-margins"></md-divider>
                                </div>
                                <div ng-if="organization.permissions[0]" class="top-padding"></div>
                                <md-divider class="extend-margins"></md-divider>
                            </div>
                        </md-tab-body>
                    </md-tab>
                </md-tabs>
            </div>
        </md-card-content>
        <md-card-actions layout="row" layout-align="end center">
            <div class="button-padding">
                <md-button class="md-cancel"
                           ng-href="#/nav/user/details/{{$ctrl.user.id}}">
                    {{'core.common.form.cancel' | translate}}
                </md-button>
            </div>
            <div class="button-padding">
                <md-button md-primary
                           ng-click="$ctrl.save()">
                    {{'core.common.form.save' | translate}}
                </md-button>
            </div>
        </md-card-actions>
    </md-card>
</div>
