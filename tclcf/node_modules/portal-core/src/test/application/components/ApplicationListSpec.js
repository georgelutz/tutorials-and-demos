describe('ApplicationList', () => {
    let component
    let ctrl
    let applications
    let currentUser
    let $state
    let $filter
    let filter
    let listService
    
    beforeEach(() => {
        applications = [
            {name: 'name1', key: 'key1'},
            {name: 'name2', key: 'key2'}
        ]

        currentUser = {}
        currentUser.hasPermission = sinon.stub()
        currentUser.hasPermission.returnsArg(0)

        $state = {}
        _.set($state, '$current.locals.globals', {
            applications, currentUser
        })

        filter = sinon.stub()
        $filter = sinon.stub().withArgs('filter').returns(filter)

        listService = {
            page: 1,
            pageSize: 10
        }

        component = require('../../../main/application/components/ApplicationList')
        ctrl = new component.controller($filter, $state, listService)

        ctrl.$onInit()
    })

    it('should initialize', () => {
        ctrl.applications.should.equal(applications)
        ctrl.staticResults.should.deep.equal([
            {
                icon: 'laptop',
                name: 'name1',
                type: 'static',
                key: 'key1',
                term: 'key1',
                param: 'app'
            }, {
                icon: 'laptop',
                name: 'name2',
                type: 'static',
                key: 'key2',
                term: 'key2',
                param: 'app'
            }
        ])
    })

    it('should not filter with no chips', () => {
        let chips = {
            selectedChips: []
        }
        ctrl.chipsUpdated(chips).should.be.true

        ctrl.rows.should.deep.equal(ctrl.applications)
        filter.should.not.have.been.called
    })

    it('should work with a single chip', () => {
        let chips = {
            selectedChips: [
                {term: 'myTerm'}
            ]
        }
        filter.withArgs(ctrl.rows, 'myTerm').returns(['abc', 'def'])
        ctrl.chipsUpdated(chips).should.be.true

        ctrl.rows.should.deep.equal(['abc', 'def'])
    })

    it('should work with a multiple chips', () => {
        let chips = {
            selectedChips: [
                {term: 'myTerm1'},
                {term: 'myTerm2'}
            ]
        }

        filter.withArgs(ctrl.rows, 'myTerm1').returns(['abc', 'def'])
        filter.withArgs(ctrl.rows, 'myTerm2').returns(['def', 'ghi'])

        ctrl.chipsUpdated(chips).should.be.true

        ctrl.rows.should.deep.equal(['def', 'abc', 'ghi'])
    })
})
